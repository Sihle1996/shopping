<div class="p-4">
  <h2 class="text-2xl font-bold mb-4">Inventory Management</h2>

  <div class="mb-4 flex gap-2">
    <button (click)="exportCsv()" class="bg-blue-600 text-white px-4 py-2 rounded">Export CSV</button>
  </div>

  <div class="filters mb-4">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      placeholder="Search by name"
      class="filter-input"
    />
    <label class="flex items-center gap-2">
      <input type="checkbox" [(ngModel)]="lowStockOnly" class="filter-checkbox" />
      <span>Low stock only</span>
    </label>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full bg-white shadow rounded hidden md:table">
      <thead>
        <tr>
          <th class="p-2 text-left">Item</th>
          <th class="p-2 text-left">Available</th>
          <th class="p-2 text-left">Reserved</th>
          <th class="p-2 text-left">Adjust</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of filteredInventory" class="border-b">
          <td class="p-2">
            {{ item.name }}
            <span *ngIf="isLowStock(item)" class="low-stock-badge">Low</span>
          </td>
          <td class="p-2">{{ item.stock }}</td>
          <td class="p-2">{{ item.reservedStock }}</td>
          <td class="p-2 flex items-center">
            <input type="number" [(ngModel)]="item.adjustStock" class="border p-1 w-20" />
            <button (click)="adjust(item)" class="ml-2 bg-green-600 text-white px-2 py-1 rounded">Save</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="card-grid md:hidden">
      <div *ngFor="let item of filteredInventory" class="card">
        <div class="flex justify-between items-center mb-2">
          <h4 class="font-semibold">{{ item.name }}</h4>
          <span *ngIf="isLowStock(item)" class="low-stock-badge">Low</span>
        </div>
        <div class="text-sm mb-2">
          <div>Available: {{ item.stock }}</div>
          <div>Reserved: {{ item.reservedStock }}</div>
        </div>
        <div class="flex items-center">
          <input type="number" [(ngModel)]="item.adjustStock" class="border p-1 w-20" />
          <button (click)="adjust(item)" class="ml-2 bg-green-600 text-white px-2 py-1 rounded">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-6">
    <div (click)="toggleAudit()" class="audit-toggle cursor-pointer">
      <span class="text-xl font-semibold">Audit Log</span>
      <svg
        class="w-4 h-4 transform transition-transform"
        [class.rotate-180]="showAudit"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
      </svg>
    </div>
    <div *ngIf="showAudit" class="mt-2">
      <ul>
        <li *ngFor="let log of auditLog">
          {{ log.timestamp }} - {{ log.menuItemName }} (stock {{ log.stockChange }}, reserved {{ log.reservedChange }})
        </li>
      </ul>
    </div>
  </div>
</div>
