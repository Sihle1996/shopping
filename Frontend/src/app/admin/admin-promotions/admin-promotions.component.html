<div class="min-h-screen bg-gray-100 p-4">
  <div class="max-w-5xl mx-auto space-y-6">
    <h2 class="text-2xl font-bold text-gray-800">Promotions</h2>

    <!-- Inline Create/Edit Form -->
    <div class="bg-white p-4 rounded shadow">
      <h3 class="text-lg font-semibold mb-3">{{ editingId ? 'Edit Promotion' : 'New Promotion' }}</h3>
      <form [formGroup]="form" (ngSubmit)="submit()" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="block">
          <span class="text-sm text-gray-600">Title</span>
          <input type="text" formControlName="title" class="mt-1 w-full border p-2 rounded" />
        </label>

        <label class="block md:col-span-2">
          <span class="text-sm text-gray-600">Description</span>
          <textarea formControlName="description" class="mt-1 w-full border p-2 rounded" rows="2"></textarea>
        </label>

        <label class="block">
          <span class="text-sm text-gray-600">Image URL</span>
          <input type="text" formControlName="imageUrl" class="mt-1 w-full border p-2 rounded" />
        </label>

        <label class="block">
          <span class="text-sm text-gray-600">Badge Text</span>
          <input type="text" formControlName="badgeText" class="mt-1 w-full border p-2 rounded" />
        </label>

        <label class="block">
          <span class="text-sm text-gray-600">Discount (%)</span>
          <input type="number" min="0" max="100" formControlName="discountPercent" class="mt-1 w-full border p-2 rounded" />
        </label>

        <label class="block">
          <span class="text-sm text-gray-600">Start</span>
          <input type="datetime-local" formControlName="startAt" class="mt-1 w-full border p-2 rounded" />
        </label>

        <label class="block">
          <span class="text-sm text-gray-600">End</span>
          <input type="datetime-local" formControlName="endAt" class="mt-1 w-full border p-2 rounded" />
        </label>

        <label class="block">
          <span class="text-sm text-gray-600">Applies To</span>
          <select formControlName="appliesTo" class="mt-1 w-full border p-2 rounded">
            <option *ngFor="let opt of appliesToOptions" [value]="opt.value">{{ opt.label }}</option>
          </select>
        </label>

        <label class="block" *ngIf="form.value.appliesTo === 'CATEGORY'">
          <span class="text-sm text-gray-600">Target Category ID</span>
          <input type="number" formControlName="targetCategoryId" class="mt-1 w-full border p-2 rounded" />
        </label>

        <label class="block" *ngIf="form.value.appliesTo === 'PRODUCT'">
          <span class="text-sm text-gray-600">Target Product ID</span>
          <input type="number" formControlName="targetProductId" class="mt-1 w-full border p-2 rounded" />
        </label>

        <label class="block">
          <span class="text-sm text-gray-600">Promo Code</span>
          <input type="text" formControlName="code" class="mt-1 w-full border p-2 rounded" />
        </label>

        <div class="flex items-center gap-4 md:col-span-2">
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" formControlName="active" /> Active
          </label>
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" formControlName="featured" /> Featured
          </label>
        </div>

        <div class="md:col-span-2 flex gap-2">
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded" [disabled]="form.invalid">{{ editingId ? 'Update' : 'Create' }}</button>
          <button type="button" class="px-4 py-2 bg-gray-200 rounded" (click)="resetForm()" *ngIf="editingId">Cancel</button>
        </div>
      </form>
    </div>

    <!-- List -->
    <div class="bg-white p-4 rounded shadow">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-semibold">All Promotions</h3>
        <button class="px-3 py-1 bg-green-600 text-white rounded" (click)="refresh()">Refresh</button>
      </div>

      <div *ngIf="loading" class="text-gray-500">Loading...</div>
      <table class="min-w-full" *ngIf="!loading">
        <thead>
          <tr class="text-left border-b">
            <th class="py-2">Title</th>
            <th class="py-2">Period</th>
            <th class="py-2">Status</th>
            <th class="py-2">Featured</th>
            <th class="py-2">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of promotions" class="border-b">
            <td class="py-2">{{ p.title }}</td>
            <td class="py-2 text-sm text-gray-600">{{ p.startAt | date:'short' }} â€” {{ p.endAt | date:'short' }}</td>
            <td class="py-2">
              <span class="px-2 py-0.5 text-xs rounded" [class]="p.active ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'">
                {{ p.active ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td class="py-2">
              <span class="px-2 py-0.5 text-xs rounded" [class]="p.featured ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-700'">
                {{ p.featured ? 'Yes' : 'No' }}
              </span>
            </td>
            <td class="py-2 space-x-2">
              <button class="px-2 py-1 bg-blue-600 text-white rounded" (click)="edit(p)">Edit</button>
              <button class="px-2 py-1 bg-gray-200 rounded" (click)="toggleActive(p)">{{ p.active ? 'Deactivate' : 'Activate' }}</button>
              <button class="px-2 py-1 bg-amber-500 text-white rounded" (click)="toggleFeatured(p)">{{ p.featured ? 'Unfeature' : 'Feature' }}</button>
              <button class="px-2 py-1 bg-red-600 text-white rounded" (click)="remove(p)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
